<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exportação de PDF com Header e Footer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <h2>Exportação de PDF</h2>
    <button onclick="generatePDF()">Exportar PDF</button>

    <script>
        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: "portrait",
                unit: "mm",
                format: "a4"
            });

            const pageWidth = 210;
            const pageHeight = 297;
            const headerHeight = 130;
            const footerHeight = 150;

            const contentStartY = headerHeight - 100;
            const contentEndY = pageHeight - (footerHeight - 100);

            async function loadImageAsBase64(url) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = () => {
                        const canvas = document.createElement("canvas");
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0);
                        resolve(canvas.toDataURL("image/png"));
                    };
                    img.onerror = (error) => reject(error);
                    img.src = url;
                });
            }

            try {
                const headerBase64 = await loadImageAsBase64("assets/images/Arquivos Timbrado/fotoHeader.png");
                doc.addImage(headerBase64, "PNG", -14, -49, pageWidth, headerHeight);

                const footerBase64 = await loadImageAsBase64("assets/images/Arquivos Timbrado/fotoFooter.png");
                doc.addImage(footerBase64, "PNG", -17, 217, 232, footerHeight);
                
                const borderStartY = contentStartY;
                const borderHeight = contentEndY;
                doc.setLineWidth(0.3);
                doc.rect(5, borderStartY, pageWidth - 10, borderHeight);
                // X, Y, Width, Height

                doc.setFontSize(14);
                doc.text("Relatório de Inserção", 10, contentStartY + 10);
                doc.setFontSize(10);
                doc.text("Painel: P.24008 - WASHINGTON SOARES | 4885", 10, contentStartY + 20);
                doc.text("Mídia: FELIPÃO-FELIPÃO-3x5", 10, contentStartY + 30);

                doc.setDrawColor(180);
                doc.setLineWidth(0.3);
                doc.line(10, contentStartY + 35, pageWidth - 10, contentStartY + 35);

                let yOffset = contentStartY + 40;
                for (let i = 1; i <= 50; i++) {
                    if (yOffset > contentEndY) {
                        doc.addPage();
                        doc.rect(5, borderStartY, pageWidth - 10, borderHeight);
                        doc.addImage(headerBase64, "PNG", -14, -49, pageWidth, headerHeight); 
                        doc.addImage(footerBase64, "PNG", -17, 217, 232, footerHeight);
                        yOffset = contentStartY + 10;
                    }
                    doc.text(`Linha de conteúdo ${i}`, 10, yOffset);
                    yOffset += 7;
                }

                doc.save("Relatorio.pdf");
            } catch (error) {
                console.error("[ERROR] Falha ao gerar PDF:", error);
            }
        }
    </script>
</body>
</html>
